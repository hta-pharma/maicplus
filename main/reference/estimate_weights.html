<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.
The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and ggplot. The default
for base R plot is to plot unscaled and scaled separately. The default
for ggplot is to plot unscaled and scaled weights on a same plot."><title>Derive individual weights in the matching step of MAIC — estimate_weights • maicplus</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive individual weights in the matching step of MAIC — estimate_weights"><meta property="og:description" content="Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.
The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and ggplot. The default
for base R plot is to plot unscaled and scaled separately. The default
for ggplot is to plot unscaled and scaled weights on a same plot."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">maicplus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/using_maicplus.html">Using maicplus</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/main">main</a> </div></li>
<!-- end dropdown for versions -->
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hta-pharma/maicplus">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Derive individual weights in the matching step of MAIC</h1>
      <small class="dont-index">Source: <a href="https://github.com/hta-pharma/maicplus/blob/HEAD/R/matching.R" class="external-link"><code>R/matching.R</code></a></small>
      <div class="d-none name"><code>estimate_weights.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.</p>
<p>The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and <code>ggplot</code>. The default
for base R plot is to plot unscaled and scaled separately. The default
for <code>ggplot</code> is to plot unscaled and scaled weights on a same plot.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_weights</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  centered_colnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start_val <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>  n_boot_iteration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  set_seed_boot <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for maicplus_estimate_weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  ggplot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bin_col <span class="op">=</span> <span class="st">"#6ECEB2"</span>,</span>
<span>  vline_col <span class="op">=</span> <span class="st">"#688CE8"</span>,</span>
<span>  main_title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaled_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bins <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>a numeric matrix, centered covariates of IPD, no missing value in any cell is allowed</p></dd>


<dt>centered_colnames</dt>
<dd><p>a character or numeric vector (column indicators) of centered covariates</p></dd>


<dt>start_val</dt>
<dd><p>a scalar, the starting value for all coefficients of the propensity score regression</p></dd>


<dt>method</dt>
<dd><p>a string, name of the optimization algorithm (see 'method' argument of <code>base::optim()</code>) The
default is <code>"BFGS"</code>, other options are <code>"Nelder-Mead"</code>, <code>"CG"</code>, <code>"L-BFGS-B"</code>, <code>"SANN"</code>, and <code>"Brent"</code></p></dd>


<dt>n_boot_iteration</dt>
<dd><p>an integer, number of bootstrap iterations. By default is NULL which means bootstrapping
procedure will not be triggered, and hence the element <code>"boot"</code> of output list object will be NULL.</p></dd>


<dt>set_seed_boot</dt>
<dd><p>a scalar, the random seed for conducting the bootstrapping, only relevant if
<code>n_boot_iteration</code> is not NULL. By default, use seed 1234</p></dd>


<dt>...</dt>
<dd><p>all other arguments from <code>base::optim()</code></p></dd>


<dt>x</dt>
<dd><p>object from estimate_weights</p></dd>


<dt>ggplot</dt>
<dd><p>indicator to print base weights plot or <code>ggplot</code> weights plot</p></dd>


<dt>bin_col</dt>
<dd><p>a string, color for the bins of histogram</p></dd>


<dt>vline_col</dt>
<dd><p>a string, color for the vertical line in the histogram</p></dd>


<dt>main_title</dt>
<dd><p>title of the plot. For ggplot, name of scaled weights plot and unscaled weights plot, respectively.</p></dd>


<dt>scaled_weights</dt>
<dd><p>(base plot only) an indicator for using scaled weights instead of regular weights</p></dd>


<dt>bins</dt>
<dd><p>(<code>ggplot</code> only) number of bin parameter to use</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list with the following 4 elements,</p><dl><dt>data</dt>
<dd><p>a data.frame, includes the input <code>data</code> with appended column 'weights' and 'scaled_weights'.
Scaled weights has a summation to be the number of rows in <code>data</code> that has no missing value in any of the
effect modifiers</p></dd>

<dt>centered_colnames</dt>
<dd><p>column names of centered effect modifiers in <code>data</code></p></dd>

<dt>nr_missing</dt>
<dd><p>number of rows in <code>data</code> that has at least 1 missing value in specified centered effect
modifiers</p></dd>

<dt>ess</dt>
<dd><p>effective sample size, square of sum divided by sum of squares</p></dd>

<dt>opt</dt>
<dd><p>R object returned by <code>base::optim()</code>, for assess convergence and other details</p></dd>

<dt>boot</dt>
<dd><p>a n by 2 by k array or NA, where n equals to number of rows in <code>data</code>, and k equals
<code>n_boot_iteration</code>. The 2 columns in the second dimension include a column of numeric indexes of the rows
in <code>data</code> that are selected at a bootstrapping iteration and a column of weights. <code>boot</code> is NA when
argument <code>n_boot_iteration</code> is set as NULL</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="methods-by-generic-">Methods (by generic)<a class="anchor" aria-label="anchor" href="#methods-by-generic-"></a></h2>
    
<ul><li><p><code>plot(maicplus_estimate_weights)</code>: Plot method for estimate_weights objects</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ipd.rda"</span>, package <span class="op">=</span> <span class="st">"maicplus"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"agd.rda"</span>, package <span class="op">=</span> <span class="st">"maicplus"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ipd_centered</span> <span class="op">&lt;-</span> <span class="fu"><a href="center_ipd.html">center_ipd</a></span><span class="op">(</span>ipd <span class="op">=</span> <span class="va">ipd</span>, agd <span class="op">=</span> <span class="va">agd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">centered_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"AGE_SQUARED"</span>, <span class="st">"SEX_MALE"</span>, <span class="st">"ECOG0"</span>, <span class="st">"SMOKE"</span>, <span class="st">"N_PR_THER_MEDIAN"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">centered_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">centered_colnames</span>, <span class="st">"_CENTERED"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weighted_data</span> <span class="op">&lt;-</span> <span class="fu">estimate_weights</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ipd_centered</span>, centered_colnames <span class="op">=</span> <span class="va">centered_colnames</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> initial  value 500.000000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iter  10 value 215.753747</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iter  20 value 199.844445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> final  value 199.842237 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"weighted_data.rda"</span>, package <span class="op">=</span> <span class="st">"maicplus"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">weighted_data</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_weights-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">weighted_data</span>, ggplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_weights-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by hta-pharma.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

