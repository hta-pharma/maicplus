<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Derive individual weights in the matching step of MAIC — estimate_weights • maicplus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive individual weights in the matching step of MAIC — estimate_weights">
<meta name="description" content="Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.
The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and ggplot. The default
for base R plot is to plot unscaled and scaled separately. The default
for ggplot is to plot unscaled and scaled weights on a same plot.">
<meta property="og:description" content="Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.
The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and ggplot. The default
for base R plot is to plot unscaled and scaled separately. The default
for ggplot is to plot unscaled and scaled weights on a same plot.">
<meta property="og:image" content="https://hta-pharma.github.io/maicplus/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">maicplus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/calculating_weights.html">Preprocessing and Calculating Weights</a></li>
    <li><a class="dropdown-item" href="../articles/anchored_binary.html">Anchored Binary Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/unanchored_binary.html">Unanchored Binary Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/anchored_survival.html">Anchored Survival Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/unanchored_survival.html">Unanchored Survival Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/kaplan_meier_plots.html">Kaplan-Meier Plots</a></li>
    <li><a class="dropdown-item" href="../articles/testing_ph_assumptions.html">Testing PH assumptions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
  </ul>
</li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/v0.1.2">v0.1.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/v0.1.1">v0.1.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://hta-pharma.github.io/maicplus/v0.1.0">v0.1.0</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hta-pharma/maicplus" aria-label="View on github.com"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Derive individual weights in the matching step of MAIC</h1>
      <small class="dont-index">Source: <a href="https://github.com/hta-pharma/maicplus/blob/main/R/matching.R" class="external-link"><code>R/matching.R</code></a></small>
      <div class="d-none name"><code>estimate_weights.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Assuming data is properly processed, this function takes individual patient data (IPD) with centered covariates
(effect modifiers and/or prognostic variables) as input, and generates weights for each individual in IPD trial to
match the covariates in aggregate data.</p>
<p>The plot function displays individuals weights with key summary in top right legend that includes
median weight, effective sample size (ESS), and reduction percentage (what percent ESS is reduced from the
original sample size). There are two options of plotting: base R plot and <code>ggplot</code>. The default
for base R plot is to plot unscaled and scaled separately. The default
for <code>ggplot</code> is to plot unscaled and scaled weights on a same plot.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a>
</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_weights</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  centered_colnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start_val <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>  n_boot_iteration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  set_seed_boot <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  boot_strata <span class="op">=</span> <span class="st">"ARM"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'maicplus_estimate_weights'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  ggplot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bin_col <span class="op">=</span> <span class="st">"#6ECEB2"</span>,</span>
<span>  vline_col <span class="op">=</span> <span class="st">"#688CE8"</span>,</span>
<span>  main_title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaled_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bins <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a>
</h2>


<dl>
<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a>
</dt>
<dd><p>a numeric matrix, centered covariates of IPD, no missing value in any cell is allowed</p></dd>


<dt id="arg-centered-colnames">centered_colnames<a class="anchor" aria-label="anchor" href="#arg-centered-colnames"></a>
</dt>
<dd><p>a character or numeric vector (column indicators) of centered covariates</p></dd>


<dt id="arg-start-val">start_val<a class="anchor" aria-label="anchor" href="#arg-start-val"></a>
</dt>
<dd><p>a scalar, the starting value for all coefficients of the propensity score regression</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a>
</dt>
<dd><p>a string, name of the optimization algorithm (see 'method' argument of <code>base::optim()</code>) The
default is <code>"BFGS"</code>, other options are <code>"Nelder-Mead"</code>, <code>"CG"</code>, <code>"L-BFGS-B"</code>, <code>"SANN"</code>, and <code>"Brent"</code></p></dd>


<dt id="arg-n-boot-iteration">n_boot_iteration<a class="anchor" aria-label="anchor" href="#arg-n-boot-iteration"></a>
</dt>
<dd><p>an integer, number of bootstrap iterations. By default is NULL which means bootstrapping
procedure will not be triggered, and hence the element <code>"boot"</code> of output list object will be NULL.</p></dd>


<dt id="arg-set-seed-boot">set_seed_boot<a class="anchor" aria-label="anchor" href="#arg-set-seed-boot"></a>
</dt>
<dd><p>a scalar, the random seed for conducting the bootstrapping, only relevant if
<code>n_boot_iteration</code> is not NULL. By default, use seed 1234</p></dd>


<dt id="arg-boot-strata">boot_strata<a class="anchor" aria-label="anchor" href="#arg-boot-strata"></a>
</dt>
<dd><p>a character vector of column names in <code>data</code> that defines the strata for bootstrapping.
This ensures that samples are drawn proportionally from each defined stratum. If <code>NULL</code>,
no stratification during bootstrapping process. By default, it is "ARM"</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a>
</dt>
<dd><p>Additional <code>control</code> parameters passed to <a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a>.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a>
</dt>
<dd><p>object from estimate_weights</p></dd>


<dt id="arg-ggplot">ggplot<a class="anchor" aria-label="anchor" href="#arg-ggplot"></a>
</dt>
<dd><p>indicator to print base weights plot or <code>ggplot</code> weights plot</p></dd>


<dt id="arg-bin-col">bin_col<a class="anchor" aria-label="anchor" href="#arg-bin-col"></a>
</dt>
<dd><p>a string, color for the bins of histogram</p></dd>


<dt id="arg-vline-col">vline_col<a class="anchor" aria-label="anchor" href="#arg-vline-col"></a>
</dt>
<dd><p>a string, color for the vertical line in the histogram</p></dd>


<dt id="arg-main-title">main_title<a class="anchor" aria-label="anchor" href="#arg-main-title"></a>
</dt>
<dd><p>title of the plot. For ggplot, name of scaled weights plot and unscaled weights plot, respectively.</p></dd>


<dt id="arg-scaled-weights">scaled_weights<a class="anchor" aria-label="anchor" href="#arg-scaled-weights"></a>
</dt>
<dd><p>(base plot only) an indicator for using scaled weights instead of regular weights</p></dd>


<dt id="arg-bins">bins<a class="anchor" aria-label="anchor" href="#arg-bins"></a>
</dt>
<dd><p>(<code>ggplot</code> only) number of bin parameter to use</p></dd>

</dl>
</div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a>
</h2>
    <p>a list with the following 4 elements,</p>
<dl>
<dt>data</dt>
<dd><p>a data.frame, includes the input <code>data</code> with appended column 'weights' and 'scaled_weights'.
Scaled weights has a summation to be the number of rows in <code>data</code> that has no missing value in any of the
effect modifiers</p></dd>

<dt>centered_colnames</dt>
<dd><p>column names of centered effect modifiers in <code>data</code></p></dd>

<dt>nr_missing</dt>
<dd><p>number of rows in <code>data</code> that has at least 1 missing value in specified centered effect
modifiers</p></dd>

<dt>ess</dt>
<dd><p>effective sample size, square of sum divided by sum of squares</p></dd>

<dt>opt</dt>
<dd><p>R object returned by <code>base::optim()</code>, for assess convergence and other details</p></dd>

<dt>boot_strata</dt>
<dd><p>'strata' from a boot::boot object</p></dd>

<dt>boot_seed</dt>
<dd><p>column names in <code>data</code> of the stratification factors</p></dd>

<dt>boot</dt>
<dd><p>a n by 2 by k array or NA, where n equals to number of rows in <code>data</code>, and k equals
<code>n_boot_iteration</code>. The 2 columns in the second dimension include a column of numeric indexes of the rows
in <code>data</code> that are selected at a bootstrapping iteration and a column of weights. <code>boot</code> is NA when
argument <code>n_boot_iteration</code> is set as NULL</p></dd>


</dl>
</div>
    <div class="section level2">
    <h2 id="methods-by-generic-">Methods (by generic)<a class="anchor" aria-label="anchor" href="#methods-by-generic-"></a>
</h2>

<ul>
<li><p><code>plot(maicplus_estimate_weights)</code>: Plot method for estimate_weights objects</p></li>
</ul>
</div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a>
</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">centered_ipd_sat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">centered_colnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_CENTERED"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">centered_ipd_sat</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weighted_data</span> <span class="op">&lt;-</span> <span class="fu">estimate_weights</span><span class="op">(</span>data <span class="op">=</span> <span class="va">centered_ipd_sat</span>, centered_colnames <span class="op">=</span> <span class="va">centered_colnames</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># To later estimate bootstrap confidence intervals, we calculate the weights</span></span></span>
<span class="r-in"><span><span class="co"># for the bootstrap samples:</span></span></span>
<span class="r-in"><span><span class="va">weighted_data_boot</span> <span class="op">&lt;-</span> <span class="fu">estimate_weights</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">centered_ipd_sat</span>, centered_colnames <span class="op">=</span> <span class="va">centered_colnames</span>, n_boot_iteration <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">weighted_sat</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_weights-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">weighted_sat</span>, ggplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="estimate_weights-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Chen, Michael Seo, Isaac Gravestock, MSD, Inc., F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
